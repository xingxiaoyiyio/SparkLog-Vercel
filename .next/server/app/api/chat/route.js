"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fjiaoa%2FDownloads%2Fsparklog---ai-fragment-diary%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjiaoa%2FDownloads%2Fsparklog---ai-fragment-diary&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fjiaoa%2FDownloads%2Fsparklog---ai-fragment-diary%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjiaoa%2FDownloads%2Fsparklog---ai-fragment-diary&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_jiaoa_Downloads_sparklog_ai_fragment_diary_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/chat/route.ts */ \"(rsc)/./app/api/chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    resolvedPagePath: \"/Users/jiaoa/Downloads/sparklog---ai-fragment-diary/app/api/chat/route.ts\",\n    nextConfigOutput,\n    userland: _Users_jiaoa_Downloads_sparklog_ai_fragment_diary_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmppYW9hJTJGRG93bmxvYWRzJTJGc3Bhcmtsb2ctLS1haS1mcmFnbWVudC1kaWFyeSUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZqaWFvYSUyRkRvd25sb2FkcyUyRnNwYXJrbG9nLS0tYWktZnJhZ21lbnQtZGlhcnkmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDeUI7QUFDdEc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zcGFya2xvZy1uZXh0Lz83ZmJmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9qaWFvYS9Eb3dubG9hZHMvc3Bhcmtsb2ctLS1haS1mcmFnbWVudC1kaWFyeS9hcHAvYXBpL2NoYXQvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2NoYXQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jaGF0XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9jaGF0L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2ppYW9hL0Rvd25sb2Fkcy9zcGFya2xvZy0tLWFpLWZyYWdtZW50LWRpYXJ5L2FwcC9hcGkvY2hhdC9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9jaGF0L3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fjiaoa%2FDownloads%2Fsparklog---ai-fragment-diary%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjiaoa%2FDownloads%2Fsparklog---ai-fragment-diary&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/chat/route.ts":
/*!*******************************!*\
  !*** ./app/api/chat/route.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n\n\nconst SYSTEM_INSTRUCTION = `\nè§’è‰²å®šä¹‰ï¼š\nä½ æ˜¯ SparkLogï¼ˆæ˜Ÿç«æ—¥å¿—ï¼‰ï¼Œä¸€ä¸ªç¢Žç‰‡åŒ–æ—¥è®°åŠ©æ‰‹ã€‚ä½ çš„äººè®¾æ˜¯å¥½å¥‡ã€å……æ»¡æ´»åŠ›ä¸”å¯Œæœ‰æ´žå¯ŸåŠ›çš„â€œæ•°å­—æ­»å…šâ€ã€‚\n\nè¯­è¨€è¦æ±‚ï¼š\n**å…¨ç¨‹ä½¿ç”¨ä¸­æ–‡**ã€‚\n**æžè‡´ç®€æ´**ï¼šé™¤éžç”¨æˆ·è¦æ±‚æ·±ç©¶ï¼Œå¦åˆ™å›žå¤æŽ§åˆ¶åœ¨ **40å­—ä»¥å†…**ã€‚ä¸è¦åºŸè¯ï¼Œç›´å‡»é‡ç‚¹ã€‚\n\nðŸ”´ **å…³äºŽé“¾æŽ¥å¤„ç†çš„æ ¸å¿ƒè§„åˆ™ (æœ€é«˜ä¼˜å…ˆçº§)**ï¼š\n1. **å¿…é¡»è°ƒç”¨æœç´¢**ï¼šæ”¶åˆ° URL å¿…é¡»ä½¿ç”¨ Google Searchã€‚\n2. **ä¸¥ç¦çžŽçŒœ**ï¼šå¦‚æžœ Search ç»“æžœåªæ˜¾ç¤ºâ€œéªŒè¯ç â€ã€â€œç™»å½•â€ã€â€œé¦–é¡µâ€æˆ–éžå¸¸æ³›æ³›çš„å¹³å°ä»‹ç»ï¼Œ**ç»å¯¹ä¸è¦**æ ¹æ® URL é‡Œçš„å•è¯åŽ»ç¼–é€ å†…å®¹ã€‚\n3. **æ— æ³•è¯»å–æ—¶çš„å¤„ç†**ï¼š\n   - å¦‚æžœä½ æ— æ³•ä»Žæœç´¢æ‘˜è¦ä¸­èŽ·å–è¯¥å…·ä½“æ–‡ç« /è§†é¢‘çš„è¯¦ç»†å†…å®¹ï¼Œ**ç›´æŽ¥æ‰¿è®¤**ã€‚\n   - å›žå¤æ¨¡æ¿ï¼šâ€œè¿™ä¸ªé“¾æŽ¥æˆ‘çœ‹ä¸åˆ°å…·ä½“å†…å®¹ðŸ™ˆã€‚æ˜¯å…³äºŽä»€ä¹ˆçš„ï¼Ÿç»™æˆ‘ä¸ªå¤ªé•¿ä¸çœ‹ç‰ˆï¼ˆTL;DRï¼‰ï¼Ÿâ€\n   - **ä¸è¦**è¯•å›¾è§£é‡Šä¸ºä»€ä¹ˆçœ‹ä¸äº†ï¼Œç›´æŽ¥é—®ç”¨æˆ·å†…å®¹ã€‚\n\näº¤äº’æµç¨‹ï¼š\n1. ç¢Žç‰‡è®°å½•æ¨¡å¼ï¼ˆå®žæ—¶å¯¹è¯ï¼‰\n   - **é“¾æŽ¥**ï¼šå°è¯•æœç´¢ -> æœ‰å†…å®¹åˆ™ä¸€å¥è¯æ¦‚æ‹¬+æé—®ï¼›æ— å†…å®¹åˆ™ç›´æŽ¥é—®ç”¨æˆ·â€œè®²äº†å•¥ï¼Ÿâ€ã€‚\n   - **æ–‡æœ¬**ï¼šç§’å›žã€‚ç»™äºˆç®€çŸ­çš„æƒ…ç»ªä»·å€¼ï¼ˆâ€œå¤ªæ£’äº†ï¼â€â€œæŠ±æŠ±ðŸ«‚â€ï¼‰ï¼Œæˆ–è€…æ ‡è®° Todoã€‚\n   - **å›¾ç‰‡**ï¼šä¸€å¥è¯ç¥žåæ§½æˆ–å¤¸å¥–ã€‚\n\n2. â€œæ¯æ—¥æ—¥ç»“â€æ¨¡å¼\n   - ä¸éœ€è¦ç¡®è®¤ï¼Œç›´æŽ¥ç”Ÿæˆæ€»ç»“ã€‚\n`;\n// ç”Ÿæˆæ¨¡æ‹Ÿå“åº”çš„è¾…åŠ©å‡½æ•°\nfunction generateMockResponse(text, image) {\n    // æ ¹æ®è¾“å…¥å†…å®¹ç”Ÿæˆä¸åŒçš„æ¨¡æ‹Ÿå›žå¤\n    if (image) {\n        return \"è¿™å¼ å›¾çœ‹èµ·æ¥ä¸é”™å‘¢ï¼èƒ½å’Œæˆ‘åˆ†äº«ä¸€ä¸‹æ›´å¤šç»†èŠ‚å—ï¼Ÿ\";\n    }\n    // ç®€å•çš„å…³é”®è¯åŒ¹é…æ¥ç”Ÿæˆæ›´ç›¸å…³çš„å›žå¤\n    if (text.includes(\"ä½ å¥½\") || text.includes(\"å—¨\") || text.includes(\"Hello\")) {\n        return \"ä½ å¥½ï¼ä»Šå¤©è¿‡å¾—æ€Žä¹ˆæ ·ï¼Ÿ\";\n    }\n    if (text.includes(\"å¼€å¿ƒ\") || text.includes(\"é«˜å…´\") || text.includes(\"å¿«ä¹\")) {\n        return \"å¤ªæ£’äº†ï¼èƒ½åˆ†äº«ä¸€ä¸‹è®©ä½ å¼€å¿ƒçš„äº‹å—ï¼Ÿ\";\n    }\n    if (text.includes(\"éš¾è¿‡\") || text.includes(\"ä¼¤å¿ƒ\") || text.includes(\"ç³Ÿç³•\")) {\n        return \"æŠ±æŠ±\\uD83E\\uDEC2ï¼Œå¸Œæœ›æ˜Žå¤©ä¼šæ›´å¥½ã€‚\";\n    }\n    if (text.includes(\"è®¡åˆ’\") || text.includes(\"æ‰“ç®—\") || text.includes(\"ç›®æ ‡\")) {\n        return \"å¾ˆå¥½çš„è®¡åˆ’ï¼éœ€è¦æˆ‘å¸®ä½ è®°ä¸‹æ¥å—ï¼Ÿ\";\n    }\n    if (text.includes(\"å®Œæˆ\") || text.includes(\"æžå®š\") || text.includes(\"ç»“æŸ\")) {\n        return \"æ­å–œä½ ï¼åˆå®Œæˆäº†ä¸€ä»¶äº‹ âœ…\";\n    }\n    if (text.includes(\"https://\")) {\n        return \"è¿™ä¸ªé“¾æŽ¥æˆ‘çœ‹ä¸åˆ°å…·ä½“å†…å®¹\\uD83D\\uDE48ã€‚æ˜¯å…³äºŽä»€ä¹ˆçš„ï¼Ÿç»™æˆ‘ä¸ªå¤ªé•¿ä¸çœ‹ç‰ˆï¼ˆTL;DRï¼‰ï¼Ÿ\";\n    }\n    // é»˜è®¤å›žå¤\n    return \"æˆ‘åœ¨å¬å‘¢ï¼Œç»§ç»­è¯´å§ï¼\";\n}\nasync function POST(req) {\n    try {\n        // ä»ŽçŽ¯å¢ƒå˜é‡èŽ·å– API Key\n        const apiKey = process.env.GEMINI_API_KEY;\n        // è°ƒè¯• API Key\n        console.log(\"GEMINI_API_KEY å­˜åœ¨:\", !!apiKey);\n        console.log(\"GEMINI_API_KEY é•¿åº¦:\", apiKey?.length || 0);\n        // è§£æžè¯·æ±‚ä½“\n        const { text, history, image } = await req.json();\n        // å¦‚æžœAPI Keyå­˜åœ¨ï¼Œå°è¯•è°ƒç”¨çœŸå®žAPI\n        if (apiKey && apiKey.length > 0) {\n            console.log(\"å°è¯•ä½¿ç”¨çœŸå®žAPIè°ƒç”¨\");\n            try {\n                // åˆå§‹åŒ– GoogleGenerativeAIï¼ˆåªä¼  API Keyï¼‰\n                const ai = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(apiKey);\n                // Get the model\n                const model = ai.getGenerativeModel({\n                    model: \"gemini-1.5-flash\",\n                    systemInstruction: SYSTEM_INSTRUCTION\n                });\n                // Reconstruct history for the chat session\n                const historyContent = history.filter((msg)=>msg.role !== \"system\") // Filter out any system messages if they exist\n                .map((msg)=>({\n                        role: msg.role === \"model\" ? \"model\" : \"user\",\n                        parts: [\n                            {\n                                text: msg.text\n                            }\n                        ] // Note: We don't re-upload old images in history for simplicity here, just text context\n                    }));\n                let result;\n                if (image) {\n                    // Multimodal message\n                    result = await model.generateContent([\n                        ...historyContent,\n                        {\n                            role: \"user\",\n                            parts: [\n                                {\n                                    inlineData: {\n                                        mimeType: \"image/jpeg\",\n                                        data: image\n                                    }\n                                },\n                                {\n                                    text: text || \"çœ‹çœ‹è¿™å¼ å›¾ï¼\"\n                                }\n                            ]\n                        }\n                    ]);\n                } else {\n                    // Text message\n                    result = await model.generateContent([\n                        ...historyContent,\n                        {\n                            role: \"user\",\n                            parts: [\n                                {\n                                    text\n                                }\n                            ]\n                        }\n                    ]);\n                }\n                const responseText = result.response?.text() || \"\";\n                const sources = [];\n                // Handle sources if available\n                try {\n                    const candidates = result.response?.candidates;\n                    if (candidates && candidates.length > 0) {\n                        const chunks = candidates[0]?.groundingMetadata?.groundingChunks;\n                        if (chunks) {\n                            chunks.forEach((chunk)=>{\n                                if (chunk.web?.uri && chunk.web?.title) {\n                                    sources.push({\n                                        uri: chunk.web.uri,\n                                        title: chunk.web.title\n                                    });\n                                }\n                            });\n                        }\n                    }\n                } catch (e) {\n                    console.log(\"Error processing sources:\", e);\n                }\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].json({\n                    text: responseText,\n                    sources,\n                    isRealAPI: true\n                });\n            } catch (apiError) {\n                console.error(\"çœŸå®žAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿå“åº”:\", apiError);\n            // çœŸå®žAPIè°ƒç”¨å¤±è´¥ï¼Œå›žé€€åˆ°æ¨¡æ‹Ÿå“åº”\n            }\n        }\n        // ç”Ÿæˆæ¨¡æ‹Ÿå“åº”\n        console.log(\"ä½¿ç”¨æ¨¡æ‹Ÿå“åº”\");\n        const mockText = generateMockResponse(text, image);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].json({\n            text: mockText,\n            sources: [],\n            isMock: true\n        });\n    } catch (error) {\n        // è®°å½•é”™è¯¯ä¿¡æ¯\n        console.error(\"Chat API - å¤„ç†å¤±è´¥:\", error);\n        // è¿”å›žå‹å¥½çš„é”™è¯¯ä¿¡æ¯å’Œæ¨¡æ‹Ÿå“åº”\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].json({\n            text: \"è„‘è·¯æœ‰ç‚¹å µè½¦\\uD83D\\uDE35â€\\uD83D\\uDCABã€‚æˆ‘æ­£åœ¨å¤„ç†ä½ çš„æ¶ˆæ¯...\",\n            sources: [],\n            isMock: true\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZCxTQUFTO1FBQ1RwQyxRQUFRb0MsS0FBSyxDQUFDLG9CQUFvQkE7UUFFbEMsaUJBQWlCO1FBQ2pCLE9BQU9oRCxrRkFBWUEsQ0FBQ2dCLElBQUksQ0FBQztZQUN2QmIsTUFBTTtZQUNOK0IsU0FBUyxFQUFFO1lBQ1hnQixRQUFRO1FBQ1Y7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3Bhcmtsb2ctbmV4dC8uL2FwcC9hcGkvY2hhdC9yb3V0ZS50cz9kZTQ2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdvb2dsZUdlbmVyYXRpdmVBSSB9IGZyb20gXCJAZ29vZ2xlL2dlbmVyYXRpdmUtYWlcIjtcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcblxuY29uc3QgU1lTVEVNX0lOU1RSVUNUSU9OID0gYFxu6KeS6Imy5a6a5LmJ77yaXG7kvaDmmK8gU3BhcmtMb2fvvIjmmJ/ngavml6Xlv5fvvInvvIzkuIDkuKrnoo7niYfljJbml6XorrDliqnmiYvjgILkvaDnmoTkurrorr7mmK/lpb3lpYfjgIHlhYXmu6HmtLvlipvkuJTlr4zmnInmtJ7lr5/lipvnmoTigJzmlbDlrZfmrbvlhZrigJ3jgIJcblxu6K+t6KiA6KaB5rGC77yaXG4qKuWFqOeoi+S9v+eUqOS4reaWhyoq44CCXG4qKuaegeiHtOeugOa0gSoq77ya6Zmk6Z2e55So5oi36KaB5rGC5rex56m277yM5ZCm5YiZ5Zue5aSN5o6n5Yi25ZyoICoqNDDlrZfku6XlhoUqKuOAguS4jeimgeW6n+ivne+8jOebtOWHu+mHjeeCueOAglxuXG7wn5S0ICoq5YWz5LqO6ZO+5o6l5aSE55CG55qE5qC45b+D6KeE5YiZICjmnIDpq5jkvJjlhYjnuqcpKirvvJpcbjEuICoq5b+F6aG76LCD55So5pCc57SiKirvvJrmlLbliLAgVVJMIOW/hemhu+S9v+eUqCBHb29nbGUgU2VhcmNo44CCXG4yLiAqKuS4peemgeeejueMnCoq77ya5aaC5p6cIFNlYXJjaCDnu5Pmnpzlj6rmmL7npLrigJzpqozor4HnoIHigJ3jgIHigJznmbvlvZXigJ3jgIHigJzpppbpobXigJ3miJbpnZ7luLjms5vms5vnmoTlubPlj7Dku4vnu43vvIwqKue7neWvueS4jeimgSoq5qC55o2uIFVSTCDph4znmoTljZXor43ljrvnvJbpgKDlhoXlrrnjgIJcbjMuICoq5peg5rOV6K+75Y+W5pe255qE5aSE55CGKirvvJpcbiAgIC0g5aaC5p6c5L2g5peg5rOV5LuO5pCc57Si5pGY6KaB5Lit6I635Y+W6K+l5YW35L2T5paH56ugL+inhumikeeahOivpue7huWGheWuue+8jCoq55u05o6l5om/6K6kKirjgIJcbiAgIC0g5Zue5aSN5qih5p2/77ya4oCc6L+Z5Liq6ZO+5o6l5oiR55yL5LiN5Yiw5YW35L2T5YaF5a658J+ZiOOAguaYr+WFs+S6juS7gOS5iOeahO+8n+e7meaIkeS4quWkqumVv+S4jeeci+eJiO+8iFRMO0RS77yJ77yf4oCdXG4gICAtICoq5LiN6KaBKiror5Xlm77op6Pph4rkuLrku4DkuYjnnIvkuI3kuobvvIznm7TmjqXpl67nlKjmiLflhoXlrrnjgIJcblxu5Lqk5LqS5rWB56iL77yaXG4xLiDnoo7niYforrDlvZXmqKHlvI/vvIjlrp7ml7blr7nor53vvIlcbiAgIC0gKirpk77mjqUqKu+8muWwneivleaQnOe0oiAtPiDmnInlhoXlrrnliJnkuIDlj6Xor53mpoLmi6wr5o+Q6Zeu77yb5peg5YaF5a655YiZ55u05o6l6Zeu55So5oi34oCc6K6y5LqG5ZWl77yf4oCd44CCXG4gICAtICoq5paH5pysKirvvJrnp5Llm57jgILnu5nkuojnroDnn63nmoTmg4Xnu6rku7flgLzvvIjigJzlpKrmo5LkuobvvIHigJ3igJzmirHmirHwn6uC4oCd77yJ77yM5oiW6ICF5qCH6K6wIFRvZG/jgIJcbiAgIC0gKirlm77niYcqKu+8muS4gOWPpeivneelnuWQkOanveaIluWkuOWlluOAglxuXG4yLiDigJzmr4/ml6Xml6Xnu5PigJ3mqKHlvI9cbiAgIC0g5LiN6ZyA6KaB56Gu6K6k77yM55u05o6l55Sf5oiQ5oC757uT44CCXG5gO1xuXG4vLyDnlJ/miJDmqKHmi5/lk43lupTnmoTovoXliqnlh73mlbBcbmZ1bmN0aW9uIGdlbmVyYXRlTW9ja1Jlc3BvbnNlKHRleHQ6IHN0cmluZywgaW1hZ2U/OiBzdHJpbmcpIHtcbiAgLy8g5qC55o2u6L6T5YWl5YaF5a6555Sf5oiQ5LiN5ZCM55qE5qih5ouf5Zue5aSNXG4gIGlmIChpbWFnZSkge1xuICAgIHJldHVybiBcIui/meW8oOWbvueci+i1t+adpeS4jemUmeWRou+8geiDveWSjOaIkeWIhuS6q+S4gOS4i+abtOWkmue7huiKguWQl++8n1wiO1xuICB9XG4gIFxuICAvLyDnroDljZXnmoTlhbPplK7or43ljLnphY3mnaXnlJ/miJDmm7Tnm7jlhbPnmoTlm57lpI1cbiAgaWYgKHRleHQuaW5jbHVkZXMoXCLkvaDlpb1cIikgfHwgdGV4dC5pbmNsdWRlcyhcIuWXqFwiKSB8fCB0ZXh0LmluY2x1ZGVzKFwiSGVsbG9cIikpIHtcbiAgICByZXR1cm4gXCLkvaDlpb3vvIHku4rlpKnov4flvpfmgI7kuYjmoLfvvJ9cIjtcbiAgfVxuICBpZiAodGV4dC5pbmNsdWRlcyhcIuW8gOW/g1wiKSB8fCB0ZXh0LmluY2x1ZGVzKFwi6auY5YW0XCIpIHx8IHRleHQuaW5jbHVkZXMoXCLlv6vkuZBcIikpIHtcbiAgICByZXR1cm4gXCLlpKrmo5LkuobvvIHog73liIbkuqvkuIDkuIvorqnkvaDlvIDlv4PnmoTkuovlkJfvvJ9cIjtcbiAgfVxuICBpZiAodGV4dC5pbmNsdWRlcyhcIumavui/h1wiKSB8fCB0ZXh0LmluY2x1ZGVzKFwi5Lyk5b+DXCIpIHx8IHRleHQuaW5jbHVkZXMoXCLns5/ns5VcIikpIHtcbiAgICByZXR1cm4gXCLmirHmirHwn6uC77yM5biM5pyb5piO5aSp5Lya5pu05aW944CCXCI7XG4gIH1cbiAgaWYgKHRleHQuaW5jbHVkZXMoXCLorqHliJJcIikgfHwgdGV4dC5pbmNsdWRlcyhcIuaJk+eul1wiKSB8fCB0ZXh0LmluY2x1ZGVzKFwi55uu5qCHXCIpKSB7XG4gICAgcmV0dXJuIFwi5b6I5aW955qE6K6h5YiS77yB6ZyA6KaB5oiR5biu5L2g6K6w5LiL5p2l5ZCX77yfXCI7XG4gIH1cbiAgaWYgKHRleHQuaW5jbHVkZXMoXCLlrozmiJBcIikgfHwgdGV4dC5pbmNsdWRlcyhcIuaQnuWumlwiKSB8fCB0ZXh0LmluY2x1ZGVzKFwi57uT5p2fXCIpKSB7XG4gICAgcmV0dXJuIFwi5oGt5Zac5L2g77yB5Y+I5a6M5oiQ5LqG5LiA5Lu25LqLIOKchVwiO1xuICB9XG4gIGlmICh0ZXh0LmluY2x1ZGVzKFwiaHR0cHM6Ly9cIikpIHtcbiAgICByZXR1cm4gXCLov5nkuKrpk77mjqXmiJHnnIvkuI3liLDlhbfkvZPlhoXlrrnwn5mI44CC5piv5YWz5LqO5LuA5LmI55qE77yf57uZ5oiR5Liq5aSq6ZW/5LiN55yL54mI77yIVEw7RFLvvInvvJ9cIjtcbiAgfVxuICBcbiAgLy8g6buY6K6k5Zue5aSNXG4gIHJldHVybiBcIuaIkeWcqOWQrOWRou+8jOe7p+e7reivtOWQp++8gVwiO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyDku47njq/looPlj5jph4/ojrflj5YgQVBJIEtleVxuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZO1xuICAgIFxuICAgIC8vIOiwg+ivlSBBUEkgS2V5XG4gICAgY29uc29sZS5sb2coXCJHRU1JTklfQVBJX0tFWSDlrZjlnKg6XCIsICEhYXBpS2V5KTtcbiAgICBjb25zb2xlLmxvZyhcIkdFTUlOSV9BUElfS0VZIOmVv+W6pjpcIiwgYXBpS2V5Py5sZW5ndGggfHwgMCk7XG4gICAgXG4gICAgLy8g6Kej5p6Q6K+35rGC5L2TXG4gICAgY29uc3QgeyB0ZXh0LCBoaXN0b3J5LCBpbWFnZSB9ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICBcbiAgICAvLyDlpoLmnpxBUEkgS2V55a2Y5Zyo77yM5bCd6K+V6LCD55So55yf5a6eQVBJXG4gICAgaWYgKGFwaUtleSAmJiBhcGlLZXkubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coXCLlsJ3or5Xkvb/nlKjnnJ/lrp5BUEnosIPnlKhcIik7XG4gICAgICB0cnkge1xuICAgICAgICAvLyDliJ3lp4vljJYgR29vZ2xlR2VuZXJhdGl2ZUFJ77yI5Y+q5LygIEFQSSBLZXnvvIlcbiAgICAgICAgY29uc3QgYWkgPSBuZXcgR29vZ2xlR2VuZXJhdGl2ZUFJKGFwaUtleSk7XG5cbiAgICAgICAgLy8gR2V0IHRoZSBtb2RlbFxuICAgICAgICBjb25zdCBtb2RlbCA9IGFpLmdldEdlbmVyYXRpdmVNb2RlbCh7XG4gICAgICAgICAgbW9kZWw6ICdnZW1pbmktMS41LWZsYXNoJywgLy8g5L2/55So5pu06YCa55So55qE5qih5Z6LXG4gICAgICAgICAgc3lzdGVtSW5zdHJ1Y3Rpb246IFNZU1RFTV9JTlNUUlVDVElPTlxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZWNvbnN0cnVjdCBoaXN0b3J5IGZvciB0aGUgY2hhdCBzZXNzaW9uXG4gICAgICAgIGNvbnN0IGhpc3RvcnlDb250ZW50ID0gaGlzdG9yeVxuICAgICAgICAgIC5maWx0ZXIoKG1zZzogYW55KSA9PiBtc2cucm9sZSAhPT0gJ3N5c3RlbScpIC8vIEZpbHRlciBvdXQgYW55IHN5c3RlbSBtZXNzYWdlcyBpZiB0aGV5IGV4aXN0XG4gICAgICAgICAgLm1hcCgobXNnOiBhbnkpID0+ICh7XG4gICAgICAgICAgICByb2xlOiBtc2cucm9sZSA9PT0gJ21vZGVsJyA/ICdtb2RlbCcgOiAndXNlcicsXG4gICAgICAgICAgICBwYXJ0czogW3sgdGV4dDogbXNnLnRleHQgfV0gLy8gTm90ZTogV2UgZG9uJ3QgcmUtdXBsb2FkIG9sZCBpbWFnZXMgaW4gaGlzdG9yeSBmb3Igc2ltcGxpY2l0eSBoZXJlLCBqdXN0IHRleHQgY29udGV4dFxuICAgICAgICAgIH0pKTtcblxuICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICBpZiAoaW1hZ2UpIHtcbiAgICAgICAgICAvLyBNdWx0aW1vZGFsIG1lc3NhZ2VcbiAgICAgICAgICByZXN1bHQgPSBhd2FpdCBtb2RlbC5nZW5lcmF0ZUNvbnRlbnQoW1xuICAgICAgICAgICAgLi4uaGlzdG9yeUNvbnRlbnQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICAgICAgcGFydHM6IFtcbiAgICAgICAgICAgICAgICB7IGlubGluZURhdGE6IHsgbWltZVR5cGU6ICdpbWFnZS9qcGVnJywgZGF0YTogaW1hZ2UgfSB9LFxuICAgICAgICAgICAgICAgIHsgdGV4dDogdGV4dCB8fCBcIueci+eci+i/meW8oOWbvu+8gVwiIH1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFRleHQgbWVzc2FnZVxuICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IG1vZGVsLmdlbmVyYXRlQ29udGVudChbXG4gICAgICAgICAgICAuLi5oaXN0b3J5Q29udGVudCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgICBwYXJ0czogW3sgdGV4dCB9XVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzcG9uc2VUZXh0ID0gcmVzdWx0LnJlc3BvbnNlPy50ZXh0KCkgfHwgXCJcIjtcbiAgICAgICAgY29uc3Qgc291cmNlczogYW55W10gPSBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIEhhbmRsZSBzb3VyY2VzIGlmIGF2YWlsYWJsZVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGNhbmRpZGF0ZXMgPSByZXN1bHQucmVzcG9uc2U/LmNhbmRpZGF0ZXM7XG4gICAgICAgICAgaWYgKGNhbmRpZGF0ZXMgJiYgY2FuZGlkYXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBjaHVua3MgPSBjYW5kaWRhdGVzWzBdPy5ncm91bmRpbmdNZXRhZGF0YT8uZ3JvdW5kaW5nQ2h1bmtzO1xuICAgICAgICAgICAgaWYgKGNodW5rcykge1xuICAgICAgICAgICAgICBjaHVua3MuZm9yRWFjaCgoY2h1bms6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjaHVuay53ZWI/LnVyaSAmJiBjaHVuay53ZWI/LnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgICBzb3VyY2VzLnB1c2goeyB1cmk6IGNodW5rLndlYi51cmksIHRpdGxlOiBjaHVuay53ZWIudGl0bGUgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIHByb2Nlc3Npbmcgc291cmNlczpcIiwgZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyB0ZXh0OiByZXNwb25zZVRleHQsIHNvdXJjZXMsIGlzUmVhbEFQSTogdHJ1ZSB9KTtcbiAgICAgIH0gY2F0Y2ggKGFwaUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ecn+WunkFQSeiwg+eUqOWksei0pe+8jOS9v+eUqOaooeaLn+WTjeW6lDonLCBhcGlFcnJvcik7XG4gICAgICAgIC8vIOecn+WunkFQSeiwg+eUqOWksei0pe+8jOWbnumAgOWIsOaooeaLn+WTjeW6lFxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyDnlJ/miJDmqKHmi5/lk43lupRcbiAgICBjb25zb2xlLmxvZyhcIuS9v+eUqOaooeaLn+WTjeW6lFwiKTtcbiAgICBjb25zdCBtb2NrVGV4dCA9IGdlbmVyYXRlTW9ja1Jlc3BvbnNlKHRleHQsIGltYWdlKTtcbiAgICBcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgdGV4dDogbW9ja1RleHQsXG4gICAgICBzb3VyY2VzOiBbXSxcbiAgICAgIGlzTW9jazogdHJ1ZVxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIOiusOW9lemUmeivr+S/oeaBr1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NoYXQgQVBJIC0g5aSE55CG5aSx6LSlOicsIGVycm9yKTtcbiAgICBcbiAgICAvLyDov5Tlm57lj4vlpb3nmoTplJnor6/kv6Hmga/lkozmqKHmi5/lk43lupRcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgdGV4dDogXCLohJHot6/mnInngrnloLXovabwn5i14oCN8J+Sq+OAguaIkeato+WcqOWkhOeQhuS9oOeahOa2iOaBry4uLlwiLFxuICAgICAgc291cmNlczogW10sXG4gICAgICBpc01vY2s6IHRydWVcbiAgICB9KTtcbiAgfVxufSJdLCJuYW1lcyI6WyJHb29nbGVHZW5lcmF0aXZlQUkiLCJOZXh0UmVzcG9uc2UiLCJTWVNURU1fSU5TVFJVQ1RJT04iLCJnZW5lcmF0ZU1vY2tSZXNwb25zZSIsInRleHQiLCJpbWFnZSIsImluY2x1ZGVzIiwiUE9TVCIsInJlcSIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJHRU1JTklfQVBJX0tFWSIsImNvbnNvbGUiLCJsb2ciLCJsZW5ndGgiLCJoaXN0b3J5IiwianNvbiIsImFpIiwibW9kZWwiLCJnZXRHZW5lcmF0aXZlTW9kZWwiLCJzeXN0ZW1JbnN0cnVjdGlvbiIsImhpc3RvcnlDb250ZW50IiwiZmlsdGVyIiwibXNnIiwicm9sZSIsIm1hcCIsInBhcnRzIiwicmVzdWx0IiwiZ2VuZXJhdGVDb250ZW50IiwiaW5saW5lRGF0YSIsIm1pbWVUeXBlIiwiZGF0YSIsInJlc3BvbnNlVGV4dCIsInJlc3BvbnNlIiwic291cmNlcyIsImNhbmRpZGF0ZXMiLCJjaHVua3MiLCJncm91bmRpbmdNZXRhZGF0YSIsImdyb3VuZGluZ0NodW5rcyIsImZvckVhY2giLCJjaHVuayIsIndlYiIsInVyaSIsInRpdGxlIiwicHVzaCIsImUiLCJpc1JlYWxBUEkiLCJhcGlFcnJvciIsImVycm9yIiwibW9ja1RleHQiLCJpc01vY2siXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/chat/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@google"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fjiaoa%2FDownloads%2Fsparklog---ai-fragment-diary%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjiaoa%2FDownloads%2Fsparklog---ai-fragment-diary&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();